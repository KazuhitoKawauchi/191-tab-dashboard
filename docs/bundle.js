(function(){"use strict";const p="4.4.0";async function b(t,e){typeof t=="string"&&(t=document.getElementById(t)),t.innerHTML=`
    <canvas id="employee-chart" style="max-width: 600px;"></canvas>
    <table id="employee-table" class="dashboard-table">
      <thead><tr><th>担当者</th><th>売上</th><th>粗利</th></tr></thead>
      <tbody></tbody>
    </table>
  `;const n=await h(e),o=m(n);f(o),y(o)}async function h(t){const e=t?`年月 = "${t}"`:"",n={app:kintone.app.getId(),query:e};return(await kintone.api(kintone.api.url("/k/v1/records",!0),"GET",n)).records}function m(t){const e={};t.forEach(d=>{const s=d.担当者.value,r=Number(d.売上.value)||0,l=Number(d.粗利.value)||0;e[s]||(e[s]={sales:0,profit:0}),e[s].sales+=r,e[s].profit+=l});const n=[],o=[],a=[],c=[];return Object.keys(e).forEach(d=>{n.push(d),o.push(e[d].sales),a.push(e[d].profit),c.push({name:d,sales:e[d].sales,profit:e[d].profit})}),{labels:n,salesData:o,profitData:a,tableRows:c}}function f({labels:t,salesData:e,profitData:n}){const o=document.getElementById("employee-chart").getContext("2d");new Chart(o,{type:"bar",data:{labels:t,datasets:[{label:"売上",data:e,backgroundColor:"rgba(54, 162, 235, 0.5)"},{label:"粗利",data:n,backgroundColor:"rgba(255, 99, 132, 0.5)"}]},options:{responsive:!0}})}function y({tableRows:t}){const e=document.querySelector("#employee-table tbody");t.forEach((n,o)=>{const a=document.createElement("tr");o%2===0&&(a.style.backgroundColor="#f2f2f2"),a.innerHTML=`<td>${n.name}</td><td>${n.sales}</td><td>${n.profit}</td>`,e.appendChild(a)})}function g(t){typeof t=="string"&&(t=document.getElementById(t)),t.innerHTML="<p>TODO: 得意先別タブを実装</p>"}function E(t){typeof t=="string"&&(t=document.getElementById(t)),t.innerHTML="<p>TODO: 品名別タブを実装</p>"}function C(t){typeof t=="string"&&(t=document.getElementById(t)),t.innerHTML="<p>TODO: 年月別タブを実装</p>"}function T(t){const e=document.createElement("div");e.className="tab-menu",e.innerHTML=`
    <button data-tab="employee" class="active">担当者別</button>
    <button data-tab="customer">得意先別</button>
    <button data-tab="product">品名別</button>
    <button data-tab="month">年月別</button>
    <select id="dashboard-select"></select>
    <button id="dashboard-reload">再表示</button>
  `;const n=document.createElement("div");n.id="tab-content",t.appendChild(e),t.appendChild(n);const o=e.querySelector("#dashboard-select"),a=new Date;for(let s=0;s<12;s++){const r=new Date(a.getFullYear(),a.getMonth()-s,1),l=r.getFullYear(),u=("0"+(r.getMonth()+1)).slice(-2),i=document.createElement("option");i.value=`${l}-${u}`,i.textContent=`${l}-${u}`,o.appendChild(i)}const c={employee:b,customer:g,product:E,month:C},d=s=>{n.innerHTML="",e.querySelectorAll("button[data-tab]").forEach(r=>{r.classList.toggle("active",r.dataset.tab===s)}),c[s](n,o.value)};e.addEventListener("click",s=>{const r=s.target.dataset.tab;r&&c[r]&&d(r)}),e.querySelector("#dashboard-reload").addEventListener("click",()=>{const s=e.querySelector("button.active").dataset.tab;d(s)}),d("employee")}(function(){const e=()=>window.Chart?Promise.resolve():new Promise((o,a)=>{const c=document.createElement("script");c.src=`https://cdn.jsdelivr.net/npm/chart.js@${p}`,c.onload=o,c.onerror=a,document.head.appendChild(c)}),n=()=>{const o=kintone.app.getHeaderSpaceElement();for(;o.firstChild;)o.removeChild(o.firstChild)};kintone.events.on("app.record.index.show",async o=>{if(Number(o.appId)!==191||document.getElementById("tab-dashboard"))return o;await e(),n();const a=document.createElement("div");return a.id="tab-dashboard",kintone.app.getHeaderSpaceElement().appendChild(a),T(a),o})})()})();
